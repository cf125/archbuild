# Contributor: Vinicius de Avila Jorge <vinicius.avila.jorge@gmail.com>
# Maintainer: William Overstreet <william.ab.overstreet@gmail.com>


pkgname=libpurple-meanwhile
pkgver=2.10.9
pkgrel=1.1
arch=('i686' 'x86_64')
url="http://pidgin.im/"
license=('GPL')
pkgdesc="Plugin for Sametime Protocol. No longer replacing pidgin package."
makedepends=('startup-notification' 'libxss' 'nss' 'libsasl' 'libsm'
             'libidn' 'python2' 'hicolor-icon-theme' 'ca-certificates' 
             'intltool' 'networkmanager')
depends=('dbus-glib' 'nss' 'meanwhile' 'pidgin')
optdepends=('avahi: Bonjour protocol support'
            'dbus-python: for purple-remote and purple-url-handler'
            'telepathy-haze: Empathy support'
            'telepathy-salut: Empathy support')
provides=('libpurple-meanwhile')
options=('!libtool')
source=(http://downloads.sourceforge.net/pidgin/pidgin-$pkgver.tar.bz2)
sha256sums=('dc362ed8577f623eea4554a79e917073aa726825074fea402f2e515f0f51f319')

build() {
  cd "$srcdir/pidgin-$pkgver"

  # The farstream patch changes configure.ac
  autoreconf -vi

 # Use Python 2
  sed -i 's/env python$/&2/' */plugins/*.py \
    libpurple/purple-{remote,notifications-example,url-handler}

  ./configure \
    --prefix=/usr \
    --sysconfdir=/etc \
    --with-dynamic-prpls=sametime \
    --disable-schemas-install \
    --disable-gnutls \
    --enable-cyrus-sasl \
    --disable-doxygen \
    --enable-nm \
    --with-python=/usr/bin/python2 \
    --with-system-ssl-certs=/etc/ssl/certs \
    --enable-silent-rules \
    --enable-shared 

  cd "$srcdir/pidgin-$pkgver/libpurple/protocols/sametime"
  make 
}

package(){
  cd "$srcdir/pidgin-$pkgver"
  make -C "libpurple/protocols" DESTDIR="$pkgdir" install
}

